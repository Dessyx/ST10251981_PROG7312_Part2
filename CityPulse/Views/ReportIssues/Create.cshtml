@{
    ViewData["Title"] = "Report Issues";
}
<div class="row g-4">
    <!-- Form Column -->
    <div class="col-12 col-lg-6">
        <h2>Report an Issue</h2>
        <form asp-action="Create" asp-controller="ReportIssues" method="post" enctype="multipart/form-data" class="row g-3">
            <div class="col-12 col-md-6">
                <label for="location" class="form-label">Location</label>
                <input id="location" name="location" class="form-control" placeholder="Start typing..." autocomplete="off" />
                <div id="location-help" class="form-text">Type to see suggestions</div>
                <div id="suggestions" class="list-group"></div>
            </div>

            <div class="col-12 col-md-6">
                <label for="category" class="form-label">Category</label>
                <select id="category" name="category" class="form-select">
                    <option value="Sanitation">Sanitation</option>
                    <option value="Roads">Roads</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Water">Water</option>
                    <option value="Electricity">Electricity</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="col-12">
                <label for="description" class="form-label">Description</label>
                <textarea id="description" name="description" class="form-control" rows="5"></textarea>
            </div>

            <div class="col-12">
                <label class="form-label">Attach images/documents (max 5MB each)</label>
                <input type="file" name="files" multiple class="form-control" />
            </div>

            <div class="col-12">
                <label class="form-label">Progress</label>
                <div class="progress">
                    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
                </div>
                <div id="engagement" class="form-text mt-1">Let's keep our city clean together!</div>
            </div>

            <div class="col-12 d-flex gap-2">
                <button type="submit" class="btn btn-primary">Submit</button>
                <a class="btn btn-secondary" asp-controller="Home" asp-action="Index">Back to Main Menu</a>
            </div>
        </form>
    </div>

    <!-- Map Column -->
    <div class="col-12 col-lg-6">
        <h2>Issue Location</h2>
        <div class="map-container mb-4">
            <!-- Google Maps Embed -->
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3153.086219640284!2d-122.41941508468157!3d37.77492927975956!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8085809c2f3ab0bf%3A0x13e65b6d2d5b4f12!2sSan+Francisco%2C+CA!5e0!3m2!1sen!2sus!4v1694266470000!5m2!1sen!2sus"
                    width="300"
                    height="600"  
                    style="border:0;"
                    allowfullscreen=""
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
    </div>
</div>




<script>
    (function() {
        const locationInput = document.getElementById('location');
        const suggestions = document.getElementById('suggestions');
        const progressBar = document.getElementById('progressBar');
        const engagement = document.getElementById('engagement');

        function updateProgress() {
            let progress = 0;
            if (locationInput.value.trim().length > 0) progress += 25;
            if (document.getElementById('category').value) progress += 25;
            if (document.getElementById('description').value.trim().length > 0) progress += 25;
            const files = document.querySelector('input[type="file"]').files;
            if (files && files.length > 0) progress += 25;
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '%';
            engagement.textContent = progress === 100 ? 'Great job! Ready to submit.' : 'You are ' + progress + '% there!';
        }

        locationInput.addEventListener('input', async function() {
            updateProgress();
            const q = locationInput.value;
            suggestions.innerHTML = '';
            if (q.length < 2) return;
            const res = await fetch('/ReportIssues/LocationSuggest?q=' + encodeURIComponent(q));
            const data = await res.json();
            for (const s of data.suggestions) {
                const a = document.createElement('a');
                a.href = '#';
                a.className = 'list-group-item list-group-item-action';
                a.textContent = s;
                a.addEventListener('click', function(e) {
                    e.preventDefault();
                    locationInput.value = s;
                    suggestions.innerHTML = '';
                    updateProgress();
                });
                suggestions.appendChild(a);
            }
        });

        document.getElementById('category').addEventListener('change', updateProgress);
        document.getElementById('description').addEventListener('input', updateProgress);
        document.querySelector('input[type="file"]').addEventListener('change', function() {
            const files = this.files;
            for (const f of files) {
                if (f.size > 5 * 1024 * 1024) {
                    alert('File exceeds 5MB: ' + f.name);
                    this.value = '';
                    break;
                }
            }
            updateProgress();
        });
    })();
</script>


