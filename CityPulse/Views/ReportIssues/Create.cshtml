@{
    ViewData["Title"] = "Report Issues";
}



<div class="row">
    <div class="col-md-6">
        
        <form asp-action="Create" asp-controller="ReportIssues" method="post" enctype="multipart/form-data" class="row g-3">
            <h2>Report an Issue</h2>
            <div class="col-12 col-md-6 position-relative">
                <label for="location" class="form-label">Location</label>
                <input id="location" name="location" class="form-control"
                       placeholder="Start typing..." autocomplete="off"
                       title="Type your city, suburb, or area within South Africa.">
                <div id="location-help" class="form-text">Type to see suggestions</div>
                <div id="suggestions" class="list-group"></div>
            </div>

            <div class="col-12">
                <label for="category" class="form-label">Category</label>
                <select id="category" name="category" class="form-select"
                        title="Select the category that best describes your issue.">
                    <option value="Sanitation">Sanitation</option>
                    <option value="Roads">Roads</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Water">Water</option>
                    <option value="Electricity">Electricity</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="col-12">
                <label for="description" class="form-label">Description</label>
                <textarea id="description" name="description" class="form-control" rows="5"
                          title="Provide a detailed description of the issue."></textarea>
            </div>

            <div class="col-12">
                <label class="form-label">Attach images/documents (max 5MB each)</label>
                <input type="file" name="files" multiple class="form-control"
                       title="Attach any relevant images or documents to help explain the issue.">
            </div>

            <div class="col-12 d-flex gap-2 mt-3">
                <button type="submit" class="btn btn-outline-dark rounded"
                        title="Click to submit your report.">
                    Submit
                </button>
                <a class="btn btn-outline-dark rounded" asp-controller="Home" asp-action="Index"
                   title="Return to the main menu without submitting.">Back to Main Menu</a>
            </div>
        </form>
    </div>


    <div class="col-md-6 d-flex align-items-center justify-content-center">
        <div id="map" style="width: 100%; height: 500px; border: 2px solid #ddd; border-radius: 10px;"></div>
    </div>
</div>


<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    var map = L.map('map').setView([-30.5595, 22.9375], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    var marker;

    const locationInput = document.getElementById('location');
    const suggestions = document.getElementById('suggestions');

    locationInput.addEventListener('input', async function () {
        const query = locationInput.value.trim();
        suggestions.innerHTML = '';
        if (query.length < 1) return;

        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&countrycodes=ZA&limit=5&addressdetails=1`);
        const data = await res.json();

        for (const place of data) {
            const a = document.createElement('a');
            a.href = '#';
            a.className = 'list-group-item list-group-item-action';
            a.textContent = place.display_name;

            a.addEventListener('click', function (e) {
                e.preventDefault();
                locationInput.value = place.display_name;
                suggestions.innerHTML = '';

                if (marker) map.removeLayer(marker);
                marker = L.marker([place.lat, place.lon]).addTo(map);
                map.setView([place.lat, place.lon], 14);
            });

            suggestions.appendChild(a);
        }
    });
</script>
